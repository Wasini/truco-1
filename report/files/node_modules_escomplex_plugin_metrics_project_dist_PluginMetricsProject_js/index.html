<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Plato - node_modules/escomplex-plugin-metrics-project/dist/PluginMetricsProject.js</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="author" content="">

  <!--[if lt IE 9]>
  <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  <link href="../../assets/css/vendor/morris.css" rel="stylesheet">
  <link href="../../assets/css/vendor/bootstrap.css" rel="stylesheet">
  <link href="../../assets/css/vendor/font-awesome.css" rel="stylesheet">
  <link href="../../assets/css/vendor/codemirror.css" rel="stylesheet">
  <link href="../../assets/css/plato.css" rel="stylesheet">
  <link href="../../assets/css/plato-file.css" rel="stylesheet">

</head>

<body>

<div class="navbar navbar-fixed-top">
  <div class="container">
    <a class="navbar-brand" href="http://github.com/es-analysis/plato">Plato on Github</a>
    <ul class="nav navbar-nav">
      <li>
        <a href="../../index.html">Report Home</a>
      </li>
    </ul>
  </div>
</div>

<div class="jumbotron">
  <div class="container">
    <h1>node_modules/escomplex-plugin-metrics-project/dist/PluginMetricsProject.js</h1>
  </div>
</div>

<div class="container aggregate-stats">
  <div class="row">
    <div class="col-md-6">
      <h2 class="header">Maintainability <a href="http://blogs.msdn.com/b/codeanalysis/archive/2007/11/20/maintainability-index-range-and-meaning.aspx"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="A value between 0 and 100 that represents the relative ease of maintaining the code. A high value means better maintainability." data-original-title="Maintainability Index"  data-container="body"></i></a></h2>
      <p class="stat">63.12</p>
    </div>
    <div class="col-md-6">
      <h2 class="header">Lines of code <i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Source Lines of Code / Logical Lines of Code" data-original-title="SLOC/LSLOC" data-container="body"></i></h2>
      <p class="stat">364</p>
    </div>
  </div>
  <div class="row historical">
    <div class="col-md-6">
      <p id="chart_historical_maint" class="chart"></p>
    </div>
    <div class="col-md-6">
      <p id="chart_historical_sloc" class="chart"></p>
    </div>
  </div>
  <div class="row">
    <div class="col-md-6">
      <h2 class="header">Difficulty  <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="The difficulty measure is related to the difficulty of the program to write or understand." data-original-title="Difficulty" data-container="body"></i></a></h2>
      <p class="stat">67.05</p>
    </div>
    <div class="col-md-6">
      <h2 class="header">Estimated Errors  <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Halstead's delivered bugs is an estimate for the number of errors in the implementation." data-original-title="Delivered Bugs" data-container="body"></i></a></h2>
      <p class="stat">2.67</p>
    </div>
  </div>
</div>

<div class="container charts">
  <div class="row">
    <h2 class="header">Function weight</h2>
  </div>
  <div class="row">
    <div class="col-md-6">
      <h3 class="chart-header">By Complexity <a href="http://en.wikipedia.org/wiki/Cyclomatic_complexity"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="This metric counts the number of distinct paths through a block of code. Lower values are better." data-original-title="Cyclomatic Complexity" data-container="body"></i></a></h3>
      <div id="fn-by-complexity" class="stat"></div>
    </div>
    <div class="col-md-6">
      <h3 class="chart-header">By SLOC  <i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Source Lines of Code / Logical Lines of Code" data-original-title="SLOC/LSLOC" data-container="body"></i></h3>
      <div id="fn-by-sloc" class="stat"></div>
    </div>
  </div>
</div>

<div class="container">
  <div class="row">
    <textarea id="file-source" class="col-md-12">&#039;use strict&#039;;

Object.defineProperty(exports, &quot;__esModule&quot;, {
   value: true
});

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i &lt; props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (&quot;value&quot; in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

var _MathUtil = require(&#039;typhonjs-escomplex-commons/dist/utils/MathUtil&#039;);

var _MathUtil2 = _interopRequireDefault(_MathUtil);

var _ObjectUtil = require(&#039;typhonjs-escomplex-commons/dist/utils/ObjectUtil&#039;);

var _ObjectUtil2 = _interopRequireDefault(_ObjectUtil);

function _interopRequireDefault(obj) { return obj &amp;&amp; obj.__esModule ? obj : { default: obj }; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(&quot;Cannot call a class as a function&quot;); } }

/**
 * Provides default project metrics gathering and calculation.
 *
 * @see https://en.wikipedia.org/wiki/Adjacency_matrix
 * @see https://en.wikipedia.org/wiki/Distance_matrix
 * @see https://en.wikipedia.org/wiki/Floyd%E2%80%93Warshall_algorithm
 */
var PluginMetricsProject = function () {
   function PluginMetricsProject() {
      _classCallCheck(this, PluginMetricsProject);
   }

   _createClass(PluginMetricsProject, [{
      key: &#039;onConfigure&#039;,

      // ESComplexProject plugin callbacks -----------------------------------------------------------------------------

      /**
       * Loads any default settings that are not already provided by any user options.
       *
       * @param {object}   ev - escomplex plugin event data.
       *
       * The following options are:
       * ```
       * (boolean)   newmi - Boolean indicating whether the maintainability index should be rebased on a scale from
       *                     0 to 100; defaults to false.
       * ```
       */
      value: function onConfigure(ev) {
         ev.data.settings.noCoreSize = typeof ev.data.options.noCoreSize === &#039;boolean&#039; ? ev.data.options.noCoreSize : false;
      }

      /**
       * Performs final calculations based on collected project report data.
       *
       * @param {object}   ev - escomplex plugin event data.
       */

   }, {
      key: &#039;onProjectEnd&#039;,
      value: function onProjectEnd(ev) {
         var pathModule = ev.data.pathModule;
         var projectReport = ev.data.projectReport;

         var adjacencyMatrix = this._calculateAdjacencyMatrix(pathModule, projectReport);

         if (!this.settings.noCoreSize) {
            var visibilityMatrix = this._calculateVisibilityMatrix(projectReport, adjacencyMatrix);
            this._calculateCoreSize(projectReport, visibilityMatrix);
         }

         this._calculateAverages(projectReport);
      }

      /**
       * Stores settings.
       *
       * @param {object}   ev - escomplex plugin event data.
       */

   }, {
      key: &#039;onProjectStart&#039;,
      value: function onProjectStart(ev) {
         /**
          * Stores the settings for all ESComplexProject plugins.
          * @type {object}
          */
         this.settings = ev.data.settings;
      }

      // Project metrics calculation -----------------------------------------------------------------------------------

      /**
       * Calculates an adjacency matrix for all modules based on ES Module and CommonJS dependencies also storing a
       * compacted while returning the matrix for further calculation. Each row index corresponds to the same module index.
       * Each row entry corresponds to a module index. These relationships dictate the dependencies between all
       * module ModuleReports given the source paths.
       *
       * @param {object}   pathModule - A module that conforms to the Node path API.
       * @param {object}   projectReport - The ProjectResult being processed.
       *
       * @returns {Array&lt;Array&lt;number&gt;&gt;}
       * @private
       */

   }, {
      key: &#039;_calculateAdjacencyMatrix&#039;,
      value: function _calculateAdjacencyMatrix(pathModule, projectReport) {
         var modules = projectReport.modules;
         var length = modules.length;

         var adjacencyMatrix = _MathUtil2.default.create2DArray(length, 0);

         var density = 0;

         for (var x = 0; x &lt; length; x++) {
            for (var y = 0; y &lt; length; y++) {
               adjacencyMatrix[x][y] = x !== y &amp;&amp; this._doesDependencyExist(pathModule, modules[x], modules[y]) ? 1 : 0;

               if (adjacencyMatrix[x][y] === 1) {
                  density += 1;
               }
            }
         }

         projectReport.adjacencyList = _MathUtil2.default.compactMatrix(adjacencyMatrix);

         projectReport.firstOrderDensity = _MathUtil2.default.getPercent(density, length * length);

         return adjacencyMatrix;
      }

      /**
       * Calculates average ModuleReport metrics that are applicable to ProjectResult.
       *
       * @param {object}   projectReport - The ProjectResult being processed.
       *
       * @private
       */

   }, {
      key: &#039;_calculateAverages&#039;,
      value: function _calculateAverages(projectReport) {
         var divisor = projectReport.modules.length === 0 ? 1 : projectReport.modules.length;

         var moduleAverage = projectReport.moduleAverage;
         var moduleAverageKeys = _ObjectUtil2.default.getAccessorList(moduleAverage);

         // Defer to ModuleReport to sum all relevant module metrics applicable to ProjectResult.
         projectReport.modules.forEach(function (module) {
            moduleAverageKeys.forEach(function (averageKey) {
               var targetValue = _ObjectUtil2.default.safeAccess(module, averageKey, 0);
               _ObjectUtil2.default.safeSet(moduleAverage, averageKey, targetValue, &#039;add&#039;);
            });
         });

         moduleAverageKeys.forEach(function (averageKey) {
            _ObjectUtil2.default.safeSet(moduleAverage, averageKey, divisor, &#039;div&#039;);
         });
      }

      /**
       * Calculates core size which is the percentage of modules / files that are both widely depended on and themselves
       * depend on other modules. Lower is better.
       *
       * @param {object}               projectReport - The ProjectResult being processed.
       * @param {Array&lt;Array&lt;number&gt;&gt;} visibilityMatrix - The calculated visibilityMatrix.
       *
       * @private
       */

   }, {
      key: &#039;_calculateCoreSize&#039;,
      value: function _calculateCoreSize(projectReport, visibilityMatrix) {
         if (projectReport.firstOrderDensity === 0) {
            projectReport.coreSize = 0;
            return;
         }

         var length = visibilityMatrix.length;

         var fanIn = new Array(length);
         var fanOut = new Array(length);
         var coreSize = 0;

         var _loop = function _loop(rowIndex) {
            fanIn[rowIndex] = visibilityMatrix[rowIndex].reduce(function (sum, value, valueIndex) {
               fanOut[valueIndex] = rowIndex === 0 ? value : fanOut[valueIndex] + value;
               return sum + value;
            }, 0);
         };

         for (var rowIndex = 0; rowIndex &lt; length; rowIndex++) {
            _loop(rowIndex);
         }

         // Boundary values can also be chosen by looking for discontinuity in the
         // distribution of values, but to keep it simple the median is used.
         var boundaries = {
            fanIn: _MathUtil2.default.getMedian(fanIn.slice()),
            fanOut: _MathUtil2.default.getMedian(fanOut.slice())
         };

         for (var _rowIndex = 0; _rowIndex &lt; length; _rowIndex++) {
            if (fanIn[_rowIndex] &gt;= boundaries.fanIn &amp;&amp; fanOut[_rowIndex] &gt;= boundaries.fanOut) {
               coreSize += 1;
            }
         }

         projectReport.coreSize = _MathUtil2.default.getPercent(coreSize, length);
      }

      /**
       * Stores a compacted form of the visibility matrix. Each row index corresponds to the same module index.
       * Each row entry corresponds to a module index. These relationships dictate the reverse visibility between all
       * module ModuleReports which may indirectly impact the given module / file. The full matrix is returned for further
       * calculation.
       *
       * Implementation of Floyd Warshall algorithm for calculating visibility matrix in O(n^3) instead of O(n^4) with
       * successive raising of powers.
       *
       * @param {object}               projectReport - The ProjectResult being processed.
       * @param {Array&lt;Array&lt;number&gt;&gt;} adjacencyMatrix - The calculated adjacencyMatrix.
       *
       * @return {Array&lt;Array&lt;number&gt;&gt;}
       * @private
       */

   }, {
      key: &#039;_calculateVisibilityMatrix&#039;,
      value: function _calculateVisibilityMatrix(projectReport, adjacencyMatrix) {
         var changeCost = 0;

         var length = adjacencyMatrix.length;
         var visibilityMatrix = _MathUtil2.default.create2DArray(length, 0);

         // Convert adjacency matrix to a distance matrix suitable for the Floyd Warshall algorithm.
         // if i !== j and adjacency matrix value is 0 set distance to Infinity.
         for (var x = 0; x &lt; length; x++) {
            for (var y = 0; y &lt; length; y++) {
               visibilityMatrix[x][y] = x === y ? 1 : adjacencyMatrix[x][y] || Infinity;
            }
         }

         // Floyd Warshall core algorithm
         for (var k = 0; k &lt; length; k++) {
            for (var _x = 0; _x &lt; length; _x++) {
               for (var _y = 0; _y &lt; length; _y++) {
                  if (visibilityMatrix[_x][_y] &gt; visibilityMatrix[_x][k] + visibilityMatrix[k][_y]) {
                     visibilityMatrix[_x][_y] = visibilityMatrix[_x][k] + visibilityMatrix[k][_y];
                  }
               }
            }
         }

         // Convert back from a distance matrix to adjacency matrix while also calculating change cost.
         for (var _x2 = 0; _x2 &lt; length; _x2++) {
            for (var _y2 = 0; _y2 &lt; length; _y2++) {
               if (visibilityMatrix[_x2][_y2] &lt; Infinity) {
                  changeCost++;

                  if (_x2 !== _y2) {
                     visibilityMatrix[_x2][_y2] = 1;
                  }
               } else {
                  visibilityMatrix[_x2][_y2] = 0;
               }
            }
         }

         projectReport.visibilityList = _MathUtil2.default.compactMatrix(visibilityMatrix);

         projectReport.changeCost = _MathUtil2.default.getPercent(changeCost, length * length);

         return visibilityMatrix;
      }

      /**
       * Determines if there is at least one dependency that matches `toModuleReport.srcPath` from all the dependencies
       * stored in `fromModuleReport`.
       *
       * @param {object}         pathModule - A module that conforms to the Node path API.
       * @param {ModuleReport}   fromModuleReport - A ModuleReport to match to the srcPath of `toModuleReport`.
       * @param {ModuleReport}   toModuleReport - A ModuleReport providing the `srcPath` to match.
       *
       * @returns {boolean}
       * @private
       */

   }, {
      key: &#039;_doesDependencyExist&#039;,
      value: function _doesDependencyExist(pathModule, fromModuleReport, toModuleReport) {
         var matchedDependency = false;
         var fromModuleReport_dirname = pathModule.dirname(fromModuleReport.srcPath);

         // First test for srcPathAlias which is the case when an NPM or JSPM module has a main entry and is mapped to a
         // given name or alias.
         for (var cntr = 0; cntr &lt; fromModuleReport.dependencies.length; cntr++) {
            var depPath = fromModuleReport.dependencies[cntr].path;

            if (typeof toModuleReport.srcPathAlias === &#039;string&#039; &amp;&amp; depPath === toModuleReport.srcPathAlias) {
               matchedDependency = true;
               break;
            }
         }

         // Exit early if alias match was found above.
         if (matchedDependency) {
            return true;
         }

         // Now test for srcPath matches.
         for (var _cntr = 0; _cntr &lt; fromModuleReport.dependencies.length; _cntr++) {
            var _depPath = fromModuleReport.dependencies[_cntr].path;

            // If there is no extension provided in the dependency then add the extension of the `to srcPath`.
            if (pathModule.extname(_depPath) === &#039;&#039;) {
               _depPath += pathModule.extname(toModuleReport.srcPath);
            }

            // Best case match scenario when dependency matches toModuleReportPath.srcPath.
            if (_depPath === toModuleReport.srcPath) {
               matchedDependency = true;
               break;
            }

            // Make sure that fromModuleReport dirname has the path separator prepended. This is necessary to make sure
            // pathModule (Node.js path) treats `fromModuleReport_dirname` as the absolute root.
            if (!fromModuleReport_dirname.startsWith(pathModule.sep)) {
               fromModuleReport_dirname = &#039;&#039; + pathModule.sep + fromModuleReport_dirname;
            }

            if (pathModule.resolve(fromModuleReport_dirname, _depPath) === toModuleReport.srcPath) {
               matchedDependency = true;
               break;
            }

            var toModuleReport_modpath = toModuleReport.srcPath;

            // Remove any local directory (`.`) leading character from `toModuleReport_modpath`.
            if (toModuleReport_modpath.startsWith(&#039;.&#039;)) {
               toModuleReport_modpath = toModuleReport_modpath.replace(/^\./, &#039;&#039;);
            }

            // Ensure `toModuleReport_modpath` starts with the path separator.
            if (!toModuleReport_modpath.startsWith(pathModule.sep)) {
               toModuleReport_modpath = &#039;&#039; + pathModule.sep + toModuleReport_modpath;
            }

            if (pathModule.resolve(fromModuleReport_dirname, _depPath) === toModuleReport_modpath) {
               matchedDependency = true;
               break;
            }
         }

         return matchedDependency;
      }
   }]);

   return PluginMetricsProject;
}();

exports.default = PluginMetricsProject;
module.exports = exports[&#039;default&#039;];</textarea>
  </div>
</div>

<footer class="footer">
  <div class="container">
    <p>.</p>
  </div>
</footer>

<script type="text/html" id="complexity-popover-template">
  <div class="complexity-notice">
    Complexity : {{ cyclomatic }} <br>
    Length : {{ halstead.length }} <br>
    Difficulty : {{ halstead.difficulty.toFixed(2) }} <br>
    Est # bugs : {{ halstead.bugs.toFixed(2) }}<br>
  </div>
</script>

<script type="text/javascript" src="../../assets/scripts/bundles/core-bundle.js"></script>
<script type="text/javascript" src="../../assets/scripts/bundles/codemirror.js"></script>
<script type="text/javascript" src="../../assets/scripts/codemirror.markpopovertext.js"></script>
<script type="text/javascript" src="report.js"></script>
<script type="text/javascript" src="report.history.js"></script>
<script type="text/javascript" src="../../assets/scripts/plato-file.js"></script>
</body>
</html>
