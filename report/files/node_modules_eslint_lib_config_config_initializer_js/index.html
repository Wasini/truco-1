<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Plato - node_modules/eslint/lib/config/config-initializer.js</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="author" content="">

  <!--[if lt IE 9]>
  <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  <link href="../../assets/css/vendor/morris.css" rel="stylesheet">
  <link href="../../assets/css/vendor/bootstrap.css" rel="stylesheet">
  <link href="../../assets/css/vendor/font-awesome.css" rel="stylesheet">
  <link href="../../assets/css/vendor/codemirror.css" rel="stylesheet">
  <link href="../../assets/css/plato.css" rel="stylesheet">
  <link href="../../assets/css/plato-file.css" rel="stylesheet">

</head>

<body>

<div class="navbar navbar-fixed-top">
  <div class="container">
    <a class="navbar-brand" href="http://github.com/es-analysis/plato">Plato on Github</a>
    <ul class="nav navbar-nav">
      <li>
        <a href="../../index.html">Report Home</a>
      </li>
    </ul>
  </div>
</div>

<div class="jumbotron">
  <div class="container">
    <h1>node_modules/eslint/lib/config/config-initializer.js</h1>
  </div>
</div>

<div class="container aggregate-stats">
  <div class="row">
    <div class="col-md-6">
      <h2 class="header">Maintainability <a href="http://blogs.msdn.com/b/codeanalysis/archive/2007/11/20/maintainability-index-range-and-meaning.aspx"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="A value between 0 and 100 that represents the relative ease of maintaining the code. A high value means better maintainability." data-original-title="Maintainability Index"  data-container="body"></i></a></h2>
      <p class="stat">60.90</p>
    </div>
    <div class="col-md-6">
      <h2 class="header">Lines of code <i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Source Lines of Code / Logical Lines of Code" data-original-title="SLOC/LSLOC" data-container="body"></i></h2>
      <p class="stat">499</p>
    </div>
  </div>
  <div class="row historical">
    <div class="col-md-6">
      <p id="chart_historical_maint" class="chart"></p>
    </div>
    <div class="col-md-6">
      <p id="chart_historical_sloc" class="chart"></p>
    </div>
  </div>
  <div class="row">
    <div class="col-md-6">
      <h2 class="header">Difficulty  <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="The difficulty measure is related to the difficulty of the program to write or understand." data-original-title="Difficulty" data-container="body"></i></a></h2>
      <p class="stat">41.18</p>
    </div>
    <div class="col-md-6">
      <h2 class="header">Estimated Errors  <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Halstead's delivered bugs is an estimate for the number of errors in the implementation." data-original-title="Delivered Bugs" data-container="body"></i></a></h2>
      <p class="stat">4.01</p>
    </div>
  </div>
</div>

<div class="container charts">
  <div class="row">
    <h2 class="header">Function weight</h2>
  </div>
  <div class="row">
    <div class="col-md-6">
      <h3 class="chart-header">By Complexity <a href="http://en.wikipedia.org/wiki/Cyclomatic_complexity"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="This metric counts the number of distinct paths through a block of code. Lower values are better." data-original-title="Cyclomatic Complexity" data-container="body"></i></a></h3>
      <div id="fn-by-complexity" class="stat"></div>
    </div>
    <div class="col-md-6">
      <h3 class="chart-header">By SLOC  <i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Source Lines of Code / Logical Lines of Code" data-original-title="SLOC/LSLOC" data-container="body"></i></h3>
      <div id="fn-by-sloc" class="stat"></div>
    </div>
  </div>
</div>

<div class="container">
  <div class="row">
    <textarea id="file-source" class="col-md-12">/**
 * @fileoverview Config initialization wizard.
 * @author Ilya Volodin
 */

&quot;use strict&quot;;

//------------------------------------------------------------------------------
// Requirements
//------------------------------------------------------------------------------

var util = require(&quot;util&quot;),
    debug = require(&quot;debug&quot;),
    lodash = require(&quot;lodash&quot;),
    inquirer = require(&quot;inquirer&quot;),
    ProgressBar = require(&quot;progress&quot;),
    autoconfig = require(&quot;./autoconfig.js&quot;),
    ConfigFile = require(&quot;./config-file&quot;),
    ConfigOps = require(&quot;./config-ops&quot;),
    getSourceCodeOfFiles = require(&quot;../util/source-code-util&quot;).getSourceCodeOfFiles,
    npmUtil = require(&quot;../util/npm-util&quot;),
    recConfig = require(&quot;../../conf/eslint.json&quot;),
    log = require(&quot;../logging&quot;);

debug = debug(&quot;eslint:config-initializer&quot;);

//------------------------------------------------------------------------------
// Private
//------------------------------------------------------------------------------

/* istanbul ignore next: hard to test fs function */
/**
 * Create .eslintrc file in the current working directory
 * @param {Object} config object that contains user&#039;s answers
 * @param {string} format The file format to write to.
 * @returns {void}
 */
function writeFile(config, format) {

    // default is .js
    var extname = &quot;.js&quot;;

    if (format === &quot;YAML&quot;) {
        extname = &quot;.yml&quot;;
    } else if (format === &quot;JSON&quot;) {
        extname = &quot;.json&quot;;
    }

    ConfigFile.write(config, &quot;./.eslintrc&quot; + extname);
    log.info(&quot;Successfully created .eslintrc&quot; + extname + &quot; file in &quot; + process.cwd());

    if (config.installedESLint) {
        log.info(&quot;ESLint was installed locally. We recommend using this local copy instead of your globally-installed copy.&quot;);
    }
}

/**
 * Synchronously install necessary plugins, configs, parsers, etc. based on the config
 * @param   {Object} config  config object
 * @returns {void}
 */
function installModules(config) {
    var modules = [],
        installStatus,
        modulesToInstall;

    // Create a list of modules which should be installed based on config
    if (config.plugins) {
        modules = modules.concat(config.plugins.map(function(name) {
            return &quot;eslint-plugin-&quot; + name;
        }));
    }
    if (config.extends &amp;&amp; config.extends.indexOf(&quot;eslint:&quot;) === -1) {
        modules.push(&quot;eslint-config-&quot; + config.extends);
    }

    // Determine which modules are already installed
    if (modules.length === 0) {
        return;
    }

    // Add eslint to list in case user does not have it installed locally
    modules.unshift(&quot;eslint&quot;);

    installStatus = npmUtil.checkDevDeps(modules);

    // Install packages which aren&#039;t already installed
    modulesToInstall = Object.keys(installStatus).filter(function(module) {
        var notInstalled = installStatus[module] === false;

        if (module === &quot;eslint&quot; &amp;&amp; notInstalled) {
            log.info(&quot;Local ESLint installation not found.&quot;);
            config.installedESLint = true;
        }

        return notInstalled;
    });

    if (modulesToInstall.length &gt; 0) {
        log.info(&quot;Installing &quot; + modulesToInstall.join(&quot;, &quot;));
        npmUtil.installSyncSaveDev(modulesToInstall);
    }
}

/**
 * Set the `rules` of a config by examining a user&#039;s source code
 *
 * Note: This clones the config object and returns a new config to avoid mutating
 * the original config parameter.
 *
 * @param   {Object} answers  answers received from inquirer
 * @param   {Object} config   config object
 * @returns {Object}          config object with configured rules
 */
function configureRules(answers, config) {
    var BAR_TOTAL = 20,
        BAR_SOURCE_CODE_TOTAL = 4;

    var newConfig = lodash.assign({}, config),
        bar,
        patterns,
        sourceCodes,
        fileQty,
        registry,
        failingRegistry,
        disabledConfigs = {},
        singleConfigs,
        specTwoConfigs,
        specThreeConfigs,
        defaultConfigs;

    // Set up a progress bar, as this process can take a long time
    bar = new ProgressBar(&quot;Determining Config: :percent [:bar] :elapseds elapsed, eta :etas &quot;, {
        width: 30,
        total: BAR_TOTAL
    });
    bar.tick(0); // Shows the progress bar

    // Get the SourceCode of all chosen files
    patterns = answers.patterns.split(/[\s]+/);
    try {
        sourceCodes = getSourceCodeOfFiles(patterns, { baseConfig: newConfig, useEslintrc: false }, function(total) {
            bar.tick((BAR_SOURCE_CODE_TOTAL / total));
        });
    } catch (e) {
        log.info(&quot;\n&quot;);
        throw e;
    }
    fileQty = Object.keys(sourceCodes).length;
    if (fileQty === 0) {
        log.info(&quot;\n&quot;);
        throw new Error(&quot;Automatic Configuration failed.  No files were able to be parsed.&quot;);
    }

    // Create a registry of rule configs
    registry = new autoconfig.Registry();
    registry.populateFromCoreRules();

    // Lint all files with each rule config in the registry
    registry = registry.lintSourceCode(sourceCodes, newConfig, function(total) {
        bar.tick((BAR_TOTAL - BAR_SOURCE_CODE_TOTAL) / total); // Subtract out ticks used at beginning
    });
    debug(&quot;\nRegistry: &quot; + util.inspect(registry.rules, {depth: null}));

    // Create a list of recommended rules, because we don&#039;t want to disable them
    var recRules = Object.keys(recConfig.rules).filter(function(ruleId) {
        return ConfigOps.isErrorSeverity(recConfig.rules[ruleId]);
    });

    // Find and disable rules which had no error-free configuration
    failingRegistry = registry.getFailingRulesRegistry();

    Object.keys(failingRegistry.rules).forEach(function(ruleId) {

        // If the rule is recommended, set it to error, otherwise disable it
        disabledConfigs[ruleId] = (recRules.indexOf(ruleId) !== -1) ? 2 : 0;
    });

    // Now that we know which rules to disable, strip out configs with errors
    registry = registry.stripFailingConfigs();

    // If there is only one config that results in no errors for a rule, we should use it.
    // createConfig will only add rules that have one configuration in the registry.
    singleConfigs = registry.createConfig().rules;

    // The &quot;sweet spot&quot; for number of options in a config seems to be two (severity plus one option).
    // Very often, a third option (usually an object) is available to address
    // edge cases, exceptions, or unique situations. We will prefer to use a config with
    // specificity of two.
    specTwoConfigs = registry.filterBySpecificity(2).createConfig().rules;

    // Maybe a specific combination using all three options works
    specThreeConfigs = registry.filterBySpecificity(3).createConfig().rules;

    // If all else fails, try to use the default (severity only)
    defaultConfigs = registry.filterBySpecificity(1).createConfig().rules;

    // Combine configs in reverse priority order (later take precedence)
    newConfig.rules = lodash.assign({}, disabledConfigs, defaultConfigs, specThreeConfigs, specTwoConfigs, singleConfigs);

    // Make sure progress bar has finished (floating point rounding)
    bar.update(BAR_TOTAL);

    // Log out some stats to let the user know what happened
    var finalRuleIds = Object.keys(newConfig.rules),
        totalRules = finalRuleIds.length;
    var enabledRules = finalRuleIds.filter(function(ruleId) {
        return (newConfig.rules[ruleId] !== 0);
    }).length;
    var resultMessage = [
        &quot;\nEnabled &quot; + enabledRules + &quot; out of &quot; + totalRules,
        &quot;rules based on &quot; + fileQty,
        &quot;file&quot; + ((fileQty === 1) ? &quot;.&quot; : &quot;s.&quot;)
    ].join(&quot; &quot;);

    log.info(resultMessage);

    ConfigOps.normalizeToStrings(newConfig);
    return newConfig;
}

/**
 * process user&#039;s answers and create config object
 * @param {Object} answers answers received from inquirer
 * @returns {Object} config object
 */
function processAnswers(answers) {
    var config = {rules: {}, env: {}};

    if (answers.es6) {
        config.env.es6 = true;
        if (answers.modules) {
            config.parserOptions = config.parserOptions || {};
            config.parserOptions.sourceType = &quot;module&quot;;
        }
    }
    if (answers.commonjs) {
        config.env.commonjs = true;
    }
    answers.env.forEach(function(env) {
        config.env[env] = true;
    });
    if (answers.jsx) {
        config.parserOptions = config.parserOptions || {};
        config.parserOptions.ecmaFeatures = config.parserOptions.ecmaFeatures || {};
        config.parserOptions.ecmaFeatures.jsx = true;
        if (answers.react) {
            config.plugins = [&quot;react&quot;];
            config.parserOptions.ecmaFeatures.experimentalObjectRestSpread = true;
        }
    }

    if (answers.source === &quot;prompt&quot;) {
        config.extends = &quot;eslint:recommended&quot;;
        config.rules.indent = [&quot;error&quot;, answers.indent];
        config.rules.quotes = [&quot;error&quot;, answers.quotes];
        config.rules[&quot;linebreak-style&quot;] = [&quot;error&quot;, answers.linebreak];
        config.rules.semi = [&quot;error&quot;, answers.semi ? &quot;always&quot; : &quot;never&quot;];
    }

    installModules(config);

    if (answers.source === &quot;auto&quot;) {
        config = configureRules(answers, config);
        config = autoconfig.extendFromRecommended(config);
    }

    ConfigOps.normalizeToStrings(config);
    return config;
}

/**
 * process user&#039;s style guide of choice and return an appropriate config object.
 * @param {string} guide name of the chosen style guide
 * @returns {Object} config object
 */
function getConfigForStyleGuide(guide) {
    var guides = {
        google: {extends: &quot;google&quot;},
        airbnb: {extends: &quot;airbnb&quot;, plugins: [&quot;react&quot;]},
        standard: {extends: &quot;standard&quot;, plugins: [&quot;standard&quot;]}
    };

    if (!guides[guide]) {
        throw new Error(&quot;You referenced an unsupported guide.&quot;);
    }

    installModules(guides[guide]);

    return guides[guide];
}

/* istanbul ignore next: no need to test inquirer*/
/**
 * Ask use a few questions on command prompt
 * @param {function} callback callback function when file has been written
 * @returns {void}
 */
function promptUser(callback) {
    var config;

    inquirer.prompt([
        {
            type: &quot;list&quot;,
            name: &quot;source&quot;,
            message: &quot;How would you like to configure ESLint?&quot;,
            default: &quot;prompt&quot;,
            choices: [
                {name: &quot;Answer questions about your style&quot;, value: &quot;prompt&quot;},
                {name: &quot;Use a popular style guide&quot;, value: &quot;guide&quot;},
                {name: &quot;Inspect your JavaScript file(s)&quot;, value: &quot;auto&quot;}
            ]
        },
        {
            type: &quot;list&quot;,
            name: &quot;styleguide&quot;,
            message: &quot;Which style guide do you want to follow?&quot;,
            choices: [{name: &quot;Google&quot;, value: &quot;google&quot;}, {name: &quot;AirBnB&quot;, value: &quot;airbnb&quot;}, {name: &quot;Standard&quot;, value: &quot;standard&quot;}],
            when: function(answers) {
                answers.packageJsonExists = npmUtil.checkPackageJson();
                return answers.source === &quot;guide&quot; &amp;&amp; answers.packageJsonExists;
            }
        },
        {
            type: &quot;input&quot;,
            name: &quot;patterns&quot;,
            message: &quot;Which file(s), path(s), or glob(s) should be examined?&quot;,
            when: function(answers) {
                return (answers.source === &quot;auto&quot;);
            },
            validate: function(input) {
                if (input.trim().length === 0 &amp;&amp; input.trim() !== &quot;,&quot;) {
                    return &quot;You must tell us what code to examine. Try again.&quot;;
                }
                return true;
            }
        },
        {
            type: &quot;list&quot;,
            name: &quot;format&quot;,
            message: &quot;What format do you want your config file to be in?&quot;,
            default: &quot;JavaScript&quot;,
            choices: [&quot;JavaScript&quot;, &quot;YAML&quot;, &quot;JSON&quot;],
            when: function(answers) {
                return ((answers.source === &quot;guide&quot; &amp;&amp; answers.packageJsonExists) || answers.source === &quot;auto&quot;);
            }
        }
    ], function(earlyAnswers) {

        // early exit if you are using a style guide
        if (earlyAnswers.source === &quot;guide&quot;) {
            if (!earlyAnswers.packageJsonExists) {
                log.info(&quot;A package.json is necessary to install plugins such as style guides. Run `npm init` to create a package.json file and try again.&quot;);
                return;
            }

            try {
                config = getConfigForStyleGuide(earlyAnswers.styleguide);
                writeFile(config, earlyAnswers.format);
            } catch (err) {
                callback(err);
                return;
            }
            return;
        }

        // continue with the questions otherwise...
        inquirer.prompt([
            {
                type: &quot;confirm&quot;,
                name: &quot;es6&quot;,
                message: &quot;Are you using ECMAScript 6 features?&quot;,
                default: false
            },
            {
                type: &quot;confirm&quot;,
                name: &quot;modules&quot;,
                message: &quot;Are you using ES6 modules?&quot;,
                default: false,
                when: function(answers) {
                    return answers.es6 === true;
                }
            },
            {
                type: &quot;checkbox&quot;,
                name: &quot;env&quot;,
                message: &quot;Where will your code run?&quot;,
                default: [&quot;browser&quot;],
                choices: [{name: &quot;Browser&quot;, value: &quot;browser&quot;}, {name: &quot;Node&quot;, value: &quot;node&quot;}]
            },
            {
                type: &quot;confirm&quot;,
                name: &quot;commonjs&quot;,
                message: &quot;Do you use CommonJS?&quot;,
                default: false,
                when: function(answers) {
                    return answers.env.some(function(env) {
                        return env === &quot;browser&quot;;
                    });
                }
            },
            {
                type: &quot;confirm&quot;,
                name: &quot;jsx&quot;,
                message: &quot;Do you use JSX?&quot;,
                default: false
            },
            {
                type: &quot;confirm&quot;,
                name: &quot;react&quot;,
                message: &quot;Do you use React&quot;,
                default: false,
                when: function(answers) {
                    return answers.jsx;
                }
            }
        ], function(secondAnswers) {

            // early exit if you are using automatic style generation
            if (earlyAnswers.source === &quot;auto&quot;) {
                try {
                    var combinedAnswers = lodash.assign({}, earlyAnswers, secondAnswers);

                    config = processAnswers(combinedAnswers);
                    installModules(config);
                    writeFile(config, earlyAnswers.format);
                } catch (err) {
                    callback(err);
                    return;
                }
                return;
            }

            // continue with the style questions otherwise...
            inquirer.prompt([
                {
                    type: &quot;list&quot;,
                    name: &quot;indent&quot;,
                    message: &quot;What style of indentation do you use?&quot;,
                    default: &quot;tab&quot;,
                    choices: [{name: &quot;Tabs&quot;, value: &quot;tab&quot;}, {name: &quot;Spaces&quot;, value: 4}]
                },
                {
                    type: &quot;list&quot;,
                    name: &quot;quotes&quot;,
                    message: &quot;What quotes do you use for strings?&quot;,
                    default: &quot;double&quot;,
                    choices: [{name: &quot;Double&quot;, value: &quot;double&quot;}, {name: &quot;Single&quot;, value: &quot;single&quot;}]
                },
                {
                    type: &quot;list&quot;,
                    name: &quot;linebreak&quot;,
                    message: &quot;What line endings do you use?&quot;,
                    default: &quot;unix&quot;,
                    choices: [{name: &quot;Unix&quot;, value: &quot;unix&quot;}, {name: &quot;Windows&quot;, value: &quot;windows&quot;}]
                },
                {
                    type: &quot;confirm&quot;,
                    name: &quot;semi&quot;,
                    message: &quot;Do you require semicolons?&quot;,
                    default: true
                },
                {
                    type: &quot;list&quot;,
                    name: &quot;format&quot;,
                    message: &quot;What format do you want your config file to be in?&quot;,
                    default: &quot;JavaScript&quot;,
                    choices: [&quot;JavaScript&quot;, &quot;YAML&quot;, &quot;JSON&quot;]
                }
            ], function(answers) {
                try {
                    var totalAnswers = lodash.assign({}, earlyAnswers, secondAnswers, answers);

                    config = processAnswers(totalAnswers);
                    installModules(config);
                    writeFile(config, answers.format);
                } catch (err) {
                    callback(err);
                    return;
                }
                return;
            });
        });
    });
}

//------------------------------------------------------------------------------
// Public Interface
//------------------------------------------------------------------------------

var init = {
    getConfigForStyleGuide: getConfigForStyleGuide,
    processAnswers: processAnswers,
    initializeConfig: /* istanbul ignore next */ function(callback) {
        promptUser(callback);
    }
};

module.exports = init;</textarea>
  </div>
</div>

<footer class="footer">
  <div class="container">
    <p>.</p>
  </div>
</footer>

<script type="text/html" id="complexity-popover-template">
  <div class="complexity-notice">
    Complexity : {{ cyclomatic }} <br>
    Length : {{ halstead.length }} <br>
    Difficulty : {{ halstead.difficulty.toFixed(2) }} <br>
    Est # bugs : {{ halstead.bugs.toFixed(2) }}<br>
  </div>
</script>

<script type="text/javascript" src="../../assets/scripts/bundles/core-bundle.js"></script>
<script type="text/javascript" src="../../assets/scripts/bundles/codemirror.js"></script>
<script type="text/javascript" src="../../assets/scripts/codemirror.markpopovertext.js"></script>
<script type="text/javascript" src="report.js"></script>
<script type="text/javascript" src="report.history.js"></script>
<script type="text/javascript" src="../../assets/scripts/plato-file.js"></script>
</body>
</html>
